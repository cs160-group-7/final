{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _FifoQueue = _interopRequireDefault(require('./FifoQueue'));\n\nvar _types = require('./types');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\nclass Farm {\n  _computeWorkerKey;\n  _workerSchedulingPolicy;\n  _cacheKeys = Object.create(null);\n  _locks = [];\n  _offset = 0;\n  _taskQueue;\n\n  constructor(_numOfWorkers, _callback) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    var _options$workerSchedu, _options$taskQueue;\n\n    this._numOfWorkers = _numOfWorkers;\n    this._callback = _callback;\n    this._computeWorkerKey = options.computeWorkerKey;\n    this._workerSchedulingPolicy = (_options$workerSchedu = options.workerSchedulingPolicy) !== null && _options$workerSchedu !== void 0 ? _options$workerSchedu : 'round-robin';\n    this._taskQueue = (_options$taskQueue = options.taskQueue) !== null && _options$taskQueue !== void 0 ? _options$taskQueue : new _FifoQueue.default();\n  }\n\n  doWork(method) {\n    const customMessageListeners = new Set();\n\n    const addCustomMessageListener = listener => {\n      customMessageListeners.add(listener);\n      return () => {\n        customMessageListeners.delete(listener);\n      };\n    };\n\n    const onCustomMessage = message => {\n      customMessageListeners.forEach(listener => listener(message));\n    };\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    const promise = new Promise( // Bind args to this function so it won't reference to the parent scope.\n    // This prevents a memory leak in v8, because otherwise the function will\n    // retain args for the closure.\n    ((args, resolve, reject) => {\n      const computeWorkerKey = this._computeWorkerKey;\n      const request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n      let worker = null;\n      let hash = null;\n\n      if (computeWorkerKey) {\n        hash = computeWorkerKey.call(this, method, ...args);\n        worker = hash == null ? null : this._cacheKeys[hash];\n      }\n\n      const onStart = worker => {\n        if (hash != null) {\n          this._cacheKeys[hash] = worker;\n        }\n      };\n\n      const onEnd = (error, result) => {\n        customMessageListeners.clear();\n\n        if (error) {\n          reject(error);\n        } else {\n          resolve(result);\n        }\n      };\n\n      const task = {\n        onCustomMessage,\n        onEnd,\n        onStart,\n        request\n      };\n\n      if (worker) {\n        this._taskQueue.enqueue(task, worker.getWorkerId());\n\n        this._process(worker.getWorkerId());\n      } else {\n        this._push(task);\n      }\n    }).bind(null, args));\n    promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n    return promise;\n  }\n\n  _process(workerId) {\n    if (this._isLocked(workerId)) {\n      return this;\n    }\n\n    const task = this._taskQueue.dequeue(workerId);\n\n    if (!task) {\n      return this;\n    }\n\n    if (task.request[1]) {\n      throw new Error('Queue implementation returned processed task');\n    } // Reference the task object outside so it won't be retained by onEnd,\n    // and other properties of the task object, such as task.request can be\n    // garbage collected.\n\n\n    let taskOnEnd = task.onEnd;\n\n    const onEnd = (error, result) => {\n      if (taskOnEnd) {\n        taskOnEnd(error, result);\n      }\n\n      taskOnEnd = null;\n\n      this._unlock(workerId);\n\n      this._process(workerId);\n    };\n\n    task.request[1] = true;\n\n    this._lock(workerId);\n\n    this._callback(workerId, task.request, task.onStart, onEnd, task.onCustomMessage);\n\n    return this;\n  }\n\n  _push(task) {\n    this._taskQueue.enqueue(task);\n\n    const offset = this._getNextWorkerOffset();\n\n    for (let i = 0; i < this._numOfWorkers; i++) {\n      this._process((offset + i) % this._numOfWorkers);\n\n      if (task.request[1]) {\n        break;\n      }\n    }\n\n    return this;\n  }\n\n  _getNextWorkerOffset() {\n    switch (this._workerSchedulingPolicy) {\n      case 'in-order':\n        return 0;\n\n      case 'round-robin':\n        return this._offset++;\n    }\n  }\n\n  _lock(workerId) {\n    this._locks[workerId] = true;\n  }\n\n  _unlock(workerId) {\n    this._locks[workerId] = false;\n  }\n\n  _isLocked(workerId) {\n    return this._locks[workerId];\n  }\n\n}\n\nexports.default = Farm;","map":{"version":3,"names":["Object","defineProperty","exports","value","default","_FifoQueue","_interopRequireDefault","require","_types","obj","__esModule","Farm","_computeWorkerKey","_workerSchedulingPolicy","_cacheKeys","create","_locks","_offset","_taskQueue","constructor","_numOfWorkers","_callback","options","_options$workerSchedu","_options$taskQueue","computeWorkerKey","workerSchedulingPolicy","taskQueue","doWork","method","customMessageListeners","Set","addCustomMessageListener","listener","add","delete","onCustomMessage","message","forEach","args","promise","Promise","resolve","reject","request","CHILD_MESSAGE_CALL","worker","hash","call","onStart","onEnd","error","result","clear","task","enqueue","getWorkerId","_process","_push","bind","UNSTABLE_onCustomMessage","workerId","_isLocked","dequeue","Error","taskOnEnd","_unlock","_lock","offset","_getNextWorkerOffset","i"],"sources":["/Users/wonjaelee/Desktop/final/node_modules/jest-runtime/node_modules/jest-worker/build/Farm.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _FifoQueue = _interopRequireDefault(require('./FifoQueue'));\n\nvar _types = require('./types');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nclass Farm {\n  _computeWorkerKey;\n  _workerSchedulingPolicy;\n  _cacheKeys = Object.create(null);\n  _locks = [];\n  _offset = 0;\n  _taskQueue;\n\n  constructor(_numOfWorkers, _callback, options = {}) {\n    var _options$workerSchedu, _options$taskQueue;\n\n    this._numOfWorkers = _numOfWorkers;\n    this._callback = _callback;\n    this._computeWorkerKey = options.computeWorkerKey;\n    this._workerSchedulingPolicy =\n      (_options$workerSchedu = options.workerSchedulingPolicy) !== null &&\n      _options$workerSchedu !== void 0\n        ? _options$workerSchedu\n        : 'round-robin';\n    this._taskQueue =\n      (_options$taskQueue = options.taskQueue) !== null &&\n      _options$taskQueue !== void 0\n        ? _options$taskQueue\n        : new _FifoQueue.default();\n  }\n\n  doWork(method, ...args) {\n    const customMessageListeners = new Set();\n\n    const addCustomMessageListener = listener => {\n      customMessageListeners.add(listener);\n      return () => {\n        customMessageListeners.delete(listener);\n      };\n    };\n\n    const onCustomMessage = message => {\n      customMessageListeners.forEach(listener => listener(message));\n    };\n\n    const promise = new Promise( // Bind args to this function so it won't reference to the parent scope.\n      // This prevents a memory leak in v8, because otherwise the function will\n      // retain args for the closure.\n      ((args, resolve, reject) => {\n        const computeWorkerKey = this._computeWorkerKey;\n        const request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n        let worker = null;\n        let hash = null;\n\n        if (computeWorkerKey) {\n          hash = computeWorkerKey.call(this, method, ...args);\n          worker = hash == null ? null : this._cacheKeys[hash];\n        }\n\n        const onStart = worker => {\n          if (hash != null) {\n            this._cacheKeys[hash] = worker;\n          }\n        };\n\n        const onEnd = (error, result) => {\n          customMessageListeners.clear();\n\n          if (error) {\n            reject(error);\n          } else {\n            resolve(result);\n          }\n        };\n\n        const task = {\n          onCustomMessage,\n          onEnd,\n          onStart,\n          request\n        };\n\n        if (worker) {\n          this._taskQueue.enqueue(task, worker.getWorkerId());\n\n          this._process(worker.getWorkerId());\n        } else {\n          this._push(task);\n        }\n      }).bind(null, args)\n    );\n    promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n    return promise;\n  }\n\n  _process(workerId) {\n    if (this._isLocked(workerId)) {\n      return this;\n    }\n\n    const task = this._taskQueue.dequeue(workerId);\n\n    if (!task) {\n      return this;\n    }\n\n    if (task.request[1]) {\n      throw new Error('Queue implementation returned processed task');\n    } // Reference the task object outside so it won't be retained by onEnd,\n    // and other properties of the task object, such as task.request can be\n    // garbage collected.\n\n    let taskOnEnd = task.onEnd;\n\n    const onEnd = (error, result) => {\n      if (taskOnEnd) {\n        taskOnEnd(error, result);\n      }\n\n      taskOnEnd = null;\n\n      this._unlock(workerId);\n\n      this._process(workerId);\n    };\n\n    task.request[1] = true;\n\n    this._lock(workerId);\n\n    this._callback(\n      workerId,\n      task.request,\n      task.onStart,\n      onEnd,\n      task.onCustomMessage\n    );\n\n    return this;\n  }\n\n  _push(task) {\n    this._taskQueue.enqueue(task);\n\n    const offset = this._getNextWorkerOffset();\n\n    for (let i = 0; i < this._numOfWorkers; i++) {\n      this._process((offset + i) % this._numOfWorkers);\n\n      if (task.request[1]) {\n        break;\n      }\n    }\n\n    return this;\n  }\n\n  _getNextWorkerOffset() {\n    switch (this._workerSchedulingPolicy) {\n      case 'in-order':\n        return 0;\n\n      case 'round-robin':\n        return this._offset++;\n    }\n  }\n\n  _lock(workerId) {\n    this._locks[workerId] = true;\n  }\n\n  _unlock(workerId) {\n    this._locks[workerId] = false;\n  }\n\n  _isLocked(workerId) {\n    return this._locks[workerId];\n  }\n}\n\nexports.default = Farm;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}